<html>
<body>

<div id="ui">
Trials Remaining: {{train_trials}}
</div>
<div id="barContainer">
{%for i in range(y|length)%}
<canvas id="bar{{i}}" class="bar" height="{{bar_height}}" width="15" onmousedown="Click(event)"></canvas>
{% endfor %}
</div>

<form method="POST" id="form">
	<input type="hidden" value="training" name="postTag">
  	<input type="hidden" id="train_response" name="train_response">
</form>

<script type="text/javascript" src="../static/init_bars.js"></script>
<script>
	init_bars([])
	var trials={{train_trials}}
	var y={{y}}
	var train_response=[]
	function Click(event){
		var bar = event.target
		if(bar.className.indexOf(" active") < 0){
		   	if(bar.className.indexOf(" focus") > 0){
		   		bar.className += " active"
		   		var x=parseInt(bar.id.substring(3))
		   		var score=y[x]
		   		console.log(x)
		   		console.log(score)
		        Move(bar.height-score);
		        Submit(x,score);

		    }else{
		        bars = document.getElementsByClassName("focus");
		        for(var i=0; i<bars.length; i++){
		            bars[i].className = bars[i].className.replace(" focus", "")
		        }
		        bar.className += " focus";
		    }
		}
	}

	function Move(ypos){
	    bar = document.getElementsByClassName("focus")[0];
	    ctx = bar.getContext("2d");
	    ctx.fillStyle = "black"
	    ctx.clearRect(0, 0, bar.width, bar.height);
	    ctx.fillRect(0, ypos, 15, bar.height);
	}

	function Submit(x,score){
		train_response.push(x)
		trials-=1
		document.getElementById("ui").innerHTML="Trials Remaining: "+trials
		if(trials==0){
			document.getElementById("train_response").value=train_response
			document.getElementById("form").submit()
		}
	}
</script>
<link rel="stylesheet" type="text/css" href="../static/bar_style.css">

</body>
</html>